% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/extract_metadata.R
\name{get_metadata}
\alias{get_metadata}
\title{Retrieve and Parse REDCap Metadata and Choice Labels}
\usage{
get_metadata(
  mode = "online",
  exclude = "ctr|wave",
  path = NULL,
  sheet = NULL,
  ...
)
}
\arguments{
\item{mode}{Character, either \code{"online"} (default) or \code{"offline"}.
\itemize{
\item \code{"online"} retrieves metadata via the REDCap API using
\code{RC_API_URL} and \code{RC_API_TOKEN} stored in environment variables
(set via \code{rc_config()}).
\item \code{"offline"} loads metadata from an external Excel/CSV file.
}}

\item{exclude}{A character pattern used to remove variables from the final
list. Default is \code{"ctr|wave"}. Matching is case-insensitive and applies
to variable names.}

\item{path}{(Offline mode only) The file path to a metadata worksheet.
Required when \code{mode = "offline"}.}

\item{sheet}{(Offline mode only) The sheet name containing the metadata.
Required when \code{mode = "offline"}.}

\item{...}{Additional arguments passed through when \code{mode = "offline"}.
Must include \code{path} and \code{sheet}.}
}
\value{
A named list where each element corresponds to one REDCap variable and
contains a tibble with three standardized fields:
\itemize{
\item \code{value}   — Raw stored REDCap value
\item \code{english} — English label
\item \code{french}  — French label (if present)
}

Variables containing no choices or excluded by \code{exclude}
are automatically removed.
}
\description{
Extracts variable-choice metadata either directly from a live REDCap project
(\code{mode = "online"}) or from a local data dictionary (\code{mode = "offline"}).
The function parses choice strings into a structured format including
\code{value}, \code{english}, and \code{french} label columns and returns
them as a named list, suitable for downstream labeling functions.
}
\details{
When \code{mode = "online"}:
\enumerate{
\item Metadata is downloaded via \code{content = "metadata"} REDCap API request.
\item \code{select_choices_or_calculations} strings are parsed into \code{value}
and multilingual labels.
\item The function \strong{splits only on the first comma}, ensuring labels
containing commas remain intact.
\item Variables matching \code{ctr|login|wave} are removed by default.
}

When \code{mode = "offline"}:
\enumerate{
\item Metadata is loaded using \code{ctrdata::temp_loader()}.
\item Choice lists are split per variable using \code{split()}.
}
}
\section{Required Configuration}{

To use \code{"online"} mode, the following environment variables
must be set beforehand:

\preformatted{
Sys.setenv(RC_API_URL   = "https://redcap.server.org/api/")
Sys.setenv(RC_API_TOKEN = "YOURTOKEN123")
}
}

\examples{
\dontrun{
## --- ONLINE MODE ---
rc_config("https://redcap.server/api/", "TOKEN123")
meta <- get_metadata()

## --- OFFLINE MODE ---
meta <- get_metadata(
  mode  = "offline",
  path  = "data_dictionary.xlsx",
  sheet = "metadata"
)
}

}
